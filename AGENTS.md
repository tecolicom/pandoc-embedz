# Repository Guidelines

## Project Structure & Module Organization
- `pandoc_embedz/` hosts the filter implementation (`filter.py`), constants like `SAVED_TEMPLATES`, and the `pandoc-embedz` console script entry point.
- `tests/` contains the `test_*.py` suites plus `tests/fixtures/` sample data; keep new coverage next to the behavior you want to lock down.
- `examples/` stores runnable Markdown that mirrors README scenarios; use it to verify CLI changes before updating docs.
- `build/`, `dist/`, and `pandoc_embedz.egg-info/` are packaging outputs generated by `python -m build`; do not commit them.

## Build, Test, and Development Commands
- `pip install -e .` links the package into your venv so changes take effect immediately.
- `pip install .[dev]` installs `pytest` and other dev extras defined under `[project.optional-dependencies]`.
- `python -m build` produces wheel and sdist artifacts in `dist/` for release candidates.
- `python -m pytest` uses the project `pyproject.toml` config (`-v`, `--strict-markers`, `--tb=short`) and automatically targets `tests/test_*.py`.
- `pandoc report.md --filter pandoc-embedz -o report.pdf` (or `pandoc-embedz` directly) exercises the filter in a realistic pipeline.

## Coding Style & Naming Conventions
- Keep Python code PEP 8-compliant: 4-space indentation, short helper functions (`snake_case`), and module-level constants in `CONSTANT_CASE`.
- Prefer explicit typing, docstrings, and config dictionaries similar to `parse_attributes` so intent stays clear.
- Use `pathlib.Path`, `validate_file_path`, and explicit checks every time you touch the filesystem, mirroring the existing security helpers.

## Testing Guidelines
- Tests live under `tests/` with `Test*` classes and `test_*` functions; name fixtures clearly and store shared data in `tests/fixtures/`.
- **IMPORTANT: Always run `python -m pytest tests/` (全テスト) before committing.** Running individual test files may miss failures in other test suites.
- Add coverage-sensitive scenarios (e.g., format detection, dot-notation parsing) as the filter evolves, and document the commands you used to validate them.

## Commit & Pull Request Guidelines
- **Before committing: Run `python -m pytest tests/` to ensure all tests pass.** This catches failures across all test suites.
- Follow the current git log style: start with a capitalized verb phrase, optionally separate a short summary from extra detail with a colon, and avoid terminal periods.
- PRs should target `main`, include a summary, list the commands you ran (tests, build, manual Pandoc runs), and link any related issues or examples.
- Mention manual verification steps (example Markdown, Pandoc output, etc.) so reviewers know what was exercised.

## Security & Configuration Tips
- Keep configuration tight: reuse `load_template_from_saved`/`validate_file_path` when reading external data so path traversal checks stay centralized.
- Store any new template snippets or CSV fixtures near the tests that validate them to make review easier.
